<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tactix HUD - YouTube Video with Drawing Overlay</title>
    <style>
        :root {
            --red-color: #EF4444;
            --yellow-color: #faf615;
            --blue-color: #3B82F6;
            --white-transparent: rgba(255, 255, 255, 0);
            --white-semi: rgba(255, 255, 255, 0.1);
            --white-more: rgba(255, 255, 255, 0.2);
            --white-opaque: rgba(255, 255, 255, 0.3);
            --black-overlay: rgba(0, 0, 0, 0.7);
            --black-shadow: rgba(0, 0, 0, 0.3);
            --black-shadow-strong: rgba(0, 0, 0, 0.4);
            --green-active: rgba(76, 175, 80, 0.8);
            --green-glow: rgba(76, 175, 80, 0.5);
            --white-glow: rgba(255, 255, 255, 0.5);
        }

        /* Base styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body, html {
            width: 100%;
            height: 100%;
            overflow: hidden;
            background: #000;
        }

        /* Layout containers */
        #video-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        #youtube-player {
            width: 100%;
            height: 100%;
            border: none;
        }

        #drawing-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 2;
            cursor: crosshair;
            pointer-events: auto;
        }

        /* Toolbar layout */
        #toolbar {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 3;
            display: flex;
            gap: 15px;
            padding: 10px 15px;
            background: var(--black-overlay);
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid var(--white-more);
            align-items: center;
        }

        .toolbar-separator {
            width: 1px;
            height: 30px;
            background: var(--white-more);
            margin: 0 5px;
        }

        .toolbar-group {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .group-label {
            color: rgba(255, 255, 255, 0.5);
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-right: 8px;
            font-weight: 600;
        }

        /* Base button styles */
        .toolbar-btn {
            border: none;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: inherit;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .toolbar-btn:hover {
            transform: scale(1.1);
        }

        /* Circular button base */
        .btn-circular {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            box-shadow: 0 2px 4px var(--black-shadow);
        }

        .btn-circular:hover {
            box-shadow: 0 4px 8px var(--black-shadow-strong);
        }

        /* Color buttons */
        .color-btn {
            position: relative;
            overflow: hidden;
        }

        .color-btn::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 3px solid transparent;
            transition: all 0.2s ease;
        }

        .color-btn.active::after {
            border-color: white;
            box-shadow: 0 0 10px var(--white-glow);
        }

        #red-btn {
            background-color: var(--red-color);
        }

        #yellow-btn {
            background-color: var(--yellow-color);
        }

        #blue-btn {
            background-color: var(--blue-color);
        }

        /* Control buttons */
        .control-btn {
            width: 40px;
            height: 40px;
            background-color: var(--white-transparent);
            color: white;
            font-size: 34px;
            box-shadow: 0 2px 4px var(--black-shadow);
            position: relative;
            top: -2px;
        }

        .control-btn:hover {
            background-color: var(--white-transparent);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0);
        }

        /* Speed control buttons */
        .speed-btn {
            background-color: var(--white-semi);
            color: white;
            font-size: 16px;
            font-weight: bold;
        }

        .speed-btn:hover {
            background-color: var(--white-opaque);
        }

        .speed-btn.active {
            background-color: var(--green-active);
            box-shadow: 0 0 10px var(--green-glow);
        }

        /* Utility classes */
        .video-foreground {
            pointer-events: none;
        }
    </style>
</head>
<body>
    <div id="video-container">
        <div id="youtube-player"></div>
    </div>
    <canvas id="drawing-canvas"></canvas>
    
    <!-- Toolbar -->
    <div id="toolbar">
        <!-- Speed Controls Group -->
        <div class="toolbar-group">
            <button id="speed-half" class="toolbar-btn btn-circular speed-btn" title="¬Ωx Speed">¬Ωx</button>
            <button id="speed-normal" class="toolbar-btn btn-circular speed-btn active" title="Normal Speed">1x</button>
            <button id="speed-double" class="toolbar-btn btn-circular speed-btn" title="2x Speed">2x</button>
        </div>
        
        <div class="toolbar-separator"></div>

        <!-- Video Controls Group -->
        <div class="toolbar-group">
            <button id="rewind-btn" class="toolbar-btn btn-circular control-btn" title="Rewind (A/‚Üê)">‚è™</button>
            <button id="play-pause-btn" class="toolbar-btn btn-circular control-btn" title="Play/Pause (S/Space)">‚è∏Ô∏è</button>
            <button id="forward-btn" class="toolbar-btn btn-circular control-btn" title="Forward (D/‚Üí)">‚è©</button>
        </div>
        
        <div class="toolbar-separator"></div>

        <!-- Drawing Tools Group -->
        <div class="toolbar-group">
            <button id="red-btn" class="toolbar-btn btn-circular color-btn active" data-color="#EF4444" title="Red (1)"></button>
            <button id="yellow-btn" class="toolbar-btn btn-circular color-btn" data-color="#faf615" title="Yellow (2)"></button>
            <button id="blue-btn" class="toolbar-btn btn-circular color-btn" data-color="#3B82F6" title="Blue (3)"></button>
            <button id="erase-btn" class="toolbar-btn btn-circular control-btn" title="Clear (E/C)">üóëÔ∏è</button>
        </div>
    </div>

    <script>
        // Tactix HUD Application - Encapsulated module
        const TactixHUD = (function() {
            // Configuration object
            const CONFIG = {
                drawing: {
                    defaultColor: '#EF4444',
                    lineWidth: 4,
                    colors: {
                        red: '#EF4444',
                        yellow: '#faf615',
                        blue: '#3B82F6'
                    }
                },
                video: {
                    defaultVideoId: 'CoFBQyle37A',
                    seekAmount: 10,
                    playbackRates: {
                        slow: 0.5,
                        normal: 1,
                        fast: 2
                    }
                },
                keyboard: {
                    colorKeys: ['1', '2', '3'],
                    eraseKeys: ['e', 'c'],
                    playPauseKeys: [' '],
                    rewindKeys: ['a', 'ArrowLeft'],
                    forwardKeys: ['d', 'ArrowRight'],
                    speedUpKeys: ['w', 'ArrowUp'],
                    speedDownKeys: ['s', 'ArrowDown']
                }
            };

            // Private variables
            let player;
            let canvas;
            let ctx;
            let isDrawing = false;
            let lastX = 0;
            let lastY = 0;
            let currentColor = CONFIG.drawing.defaultColor;
            let lineWidth = CONFIG.drawing.lineWidth;

        // Get video ID from URL parameter or use default
        function getVideoId() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('videoId') || CONFIG.video.defaultVideoId;
        }

        // Debounce utility function
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // Load YouTube IFrame API
        function loadYouTubeAPI() {
            const tag = document.createElement('script');
            tag.src = 'https://www.youtube.com/iframe_api';
            const firstScriptTag = document.getElementsByTagName('script')[0];
            firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
        }

        // YouTube API ready callback
        function onYouTubeIframeAPIReady() {
            try {
                player = new YT.Player('youtube-player', {
                    height: '100%',
                    width: '100%',
                    videoId: getVideoId(),
                    playerVars: {
                        'autoplay': 1,
                        'controls': 0,
                        'disablekb': 1,
                        'fs': 0,
                        'iv_load_policy': 3,
                        'modestbranding': 1,
                        'playsinline': 1,
                        'rel': 0,
                        'showinfo': 0,
                        'mute': 1
                    },
                    events: {
                        'onReady': onPlayerReady,
                        'onStateChange': onPlayerStateChange
                    }
                });
            } catch (error) {
                console.error('Error initializing YouTube player:', error);
            }
        }

        function onPlayerReady(event) {
            try {
                event.target.playVideo();
                setupCanvas();
                setupToolbar();
                setupVideoControls();
            } catch (error) {
                console.error('Error initializing player:', error);
            }
        }

        function onPlayerStateChange(event) {
            updatePlayPauseButton(event.data);
        }

        function updatePlayPauseButton(state) {
            const playPauseBtn = document.getElementById('play-pause-btn');
            if (playPauseBtn) {
                if (state === YT.PlayerState.PLAYING) {
                    playPauseBtn.textContent = '‚è∏Ô∏è';
                } else {
                    playPauseBtn.textContent = '‚ñ∂Ô∏è';
                }
            }
        }

        function setupCanvas() {
            canvas = document.getElementById('drawing-canvas');
            ctx = canvas.getContext('2d');
            
            // Set canvas size to match viewport
            resizeCanvas();
            
            // Set drawing properties
            restoreCanvasProperties();
            
            // Add event listeners for drawing
            addDrawingEventListeners();
            
            // Add resize listener with debouncing
            window.addEventListener('resize', debounce(resizeCanvas, 250));
        }

        function restoreCanvasProperties() {
            ctx.strokeStyle = currentColor;
            ctx.lineWidth = lineWidth;
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
        }

        function resizeCanvas() {
            // Save current drawing
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            
            // Resize
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            
            // Restore drawing if it fits
            if (imageData.width <= canvas.width && imageData.height <= canvas.height) {
                ctx.putImageData(imageData, 0, 0);
            }
            
            // Restore drawing properties
            restoreCanvasProperties();
        }

        function addDrawingEventListeners() {
            // Mouse events
            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('mouseout', stopDrawing);
            
            // Touch events for mobile support
            canvas.addEventListener('touchstart', handleTouch);
            canvas.addEventListener('touchmove', handleTouch);
            canvas.addEventListener('touchend', stopDrawing);
        }

        function startDrawing(e) {
            isDrawing = true;
            const rect = canvas.getBoundingClientRect();
            lastX = e.clientX - rect.left;
            lastY = e.clientY - rect.top;
        }

        function draw(e) {
            if (!isDrawing || !ctx) return;
            
            try {
                const rect = canvas.getBoundingClientRect();
                const currentX = e.clientX - rect.left;
                const currentY = e.clientY - rect.top;
                
                // Normal drawing only (erasing is handled by button click)
                ctx.strokeStyle = currentColor;
                ctx.lineWidth = lineWidth;
                ctx.beginPath();
                ctx.moveTo(lastX, lastY);
                ctx.lineTo(currentX, currentY);
                ctx.stroke();
                
                lastX = currentX;
                lastY = currentY;
            } catch (error) {
                console.error('Drawing error:', error);
                stopDrawing();
            }
        }

        function stopDrawing() {
            isDrawing = false;
        }

        function handleTouch(e) {
            e.preventDefault();
            
            if (!e.touches || e.touches.length === 0) return;
            
            const touch = e.touches[0];
            const eventType = {
                'touchstart': 'mousedown',
                'touchmove': 'mousemove',
                'touchend': 'mouseup'
            }[e.type];
            
            if (eventType) {
                const mouseEvent = new MouseEvent(eventType, {
                    clientX: touch.clientX,
                    clientY: touch.clientY,
                    bubbles: true,
                    cancelable: true
                });
                canvas.dispatchEvent(mouseEvent);
            }
        }

        function setupToolbar() {
            const colorButtons = document.querySelectorAll('.color-btn');
            const eraseButton = document.getElementById('erase-btn');
            
            // Color button event listeners
            colorButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    // Remove active class from all color buttons
                    document.querySelectorAll('.color-btn').forEach(b => b.classList.remove('active'));
                    
                    // Add active class to clicked button
                    this.classList.add('active');
                    
                    // Set current color
                    currentColor = this.dataset.color;
                    
                    // Update canvas cursor
                    canvas.style.cursor = 'crosshair';
                });
            });
            
            // Erase button event listener
            eraseButton.addEventListener('click', function() {
                // Clear the entire canvas
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // Reset to the last selected color (don't change active state)
                // Find the currently active color button
                const activeColorBtn = document.querySelector('.color-btn.active');
                if (!activeColorBtn) {
                    // If no color is active, default to red
                    document.getElementById('red-btn').classList.add('active');
                    currentColor = CONFIG.drawing.defaultColor;
                }
                
                canvas.style.cursor = 'crosshair';
            });
        }

        function setupVideoControls() {
            const playPauseBtn = document.getElementById('play-pause-btn');
            const rewindBtn = document.getElementById('rewind-btn');
            const forwardBtn = document.getElementById('forward-btn');
            const speedHalfBtn = document.getElementById('speed-half');
            const speedNormalBtn = document.getElementById('speed-normal');
            const speedDoubleBtn = document.getElementById('speed-double');
            
            playPauseBtn.addEventListener('click', function() {
                if (player && player.getPlayerState) {
                    const state = player.getPlayerState();
                    if (state === YT.PlayerState.PLAYING) {
                        player.pauseVideo();
                        this.textContent = '‚ñ∂Ô∏è';
                    } else {
                        player.playVideo();
                        this.textContent = '‚è∏Ô∏è';
                    }
                }
            });
            
            rewindBtn.addEventListener('click', function() {
                if (player && player.getCurrentTime) {
                    const currentTime = player.getCurrentTime();
                    player.seekTo(Math.max(0, currentTime - CONFIG.video.seekAmount), true);
                }
            });
            
            forwardBtn.addEventListener('click', function() {
                if (player && player.getCurrentTime && player.getDuration) {
                    const currentTime = player.getCurrentTime();
                    const duration = player.getDuration();
                    player.seekTo(Math.min(duration, currentTime + CONFIG.video.seekAmount), true);
                }
            });

            // Speed control event listeners
            speedHalfBtn.addEventListener('click', function() {
                if (player && player.setPlaybackRate) {
                    player.setPlaybackRate(CONFIG.video.playbackRates.slow);
                    updateSpeedButtons('speed-half');
                }
            });

            speedNormalBtn.addEventListener('click', function() {
                if (player && player.setPlaybackRate) {
                    player.setPlaybackRate(CONFIG.video.playbackRates.normal);
                    updateSpeedButtons('speed-normal');
                }
            });

            speedDoubleBtn.addEventListener('click', function() {
                if (player && player.setPlaybackRate) {
                    player.setPlaybackRate(CONFIG.video.playbackRates.fast);
                    updateSpeedButtons('speed-double');
                }
            });
        }

        function updateSpeedButtons(activeId) {
            // Remove active class from all speed buttons
            document.querySelectorAll('.speed-btn').forEach(btn => btn.classList.remove('active'));
            // Add active class to the clicked button
            document.getElementById(activeId).classList.add('active');
        }


        // Keyboard shortcuts
        const keyboardActions = {
            '1': () => document.getElementById('red-btn').click(),
            '2': () => document.getElementById('yellow-btn').click(),
            '3': () => document.getElementById('blue-btn').click(),
            'e': () => ctx.clearRect(0, 0, canvas.width, canvas.height),
            'c': () => ctx.clearRect(0, 0, canvas.width, canvas.height),
            ' ': (e) => {
                e.preventDefault();
                document.getElementById('play-pause-btn').click();
            },
            'a': (e) => {
                e.preventDefault();
                document.getElementById('rewind-btn').click();
            },
            'ArrowLeft': (e) => {
                e.preventDefault();
                document.getElementById('rewind-btn').click();
            },
            'd': (e) => {
                e.preventDefault();
                document.getElementById('forward-btn').click();
            },
            'ArrowRight': (e) => {
                e.preventDefault();
                document.getElementById('forward-btn').click();
            },
            'w': (e) => {
                e.preventDefault();
                if (player && player.getPlaybackRate) {
                    const rate = player.getPlaybackRate();
                    if (rate < 2) {
                        if (rate < 1) {
                            document.getElementById('speed-normal').click();
                        } else {
                            document.getElementById('speed-double').click();
                        }
                    }
                }
            },
            'ArrowUp': (e) => {
                e.preventDefault();
                if (player && player.getPlaybackRate) {
                    const rate = player.getPlaybackRate();
                    if (rate < 2) {
                        if (rate < 1) {
                            document.getElementById('speed-normal').click();
                        } else {
                            document.getElementById('speed-double').click();
                        }
                    }
                }
            },
            's': (e) => {
                e.preventDefault();
                if (player && player.getPlaybackRate) {
                    const rate = player.getPlaybackRate();
                    if (rate > 0.5) {
                        if (rate > 1) {
                            document.getElementById('speed-normal').click();
                        } else {
                            document.getElementById('speed-half').click();
                        }
                    }
                }
            },
            'ArrowDown': (e) => {
                e.preventDefault();
                if (player && player.getPlaybackRate) {
                    const rate = player.getPlaybackRate();
                    if (rate > 0.5) {
                        if (rate > 1) {
                            document.getElementById('speed-normal').click();
                        } else {
                            document.getElementById('speed-half').click();
                        }
                    }
                }
            }
        };

        document.addEventListener('keydown', function(e) {
            const key = e.key.toLowerCase();
            const action = keyboardActions[key] || keyboardActions[e.key];
            
            if (action) {
                action(e);
            }
        });

        // Initialize everything
        document.addEventListener('DOMContentLoaded', function() {
            loadYouTubeAPI();
        });

        // Make onYouTubeIframeAPIReady available globally
        window.onYouTubeIframeAPIReady = onYouTubeIframeAPIReady;

        // Public API
        return {
            init: function() {
                document.addEventListener('DOMContentLoaded', function() {
                    loadYouTubeAPI();
                });
                window.onYouTubeIframeAPIReady = onYouTubeIframeAPIReady;
            }
        };
    })();

    // Initialize the application
    TactixHUD.init();
    </script>
</body>
</html>
